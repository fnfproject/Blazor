@page "/enable-2fa"
@using System.Text
@using System.Text.Json
@using System.Net.Http
@using System.Net.Http.Headers
@using QuestionBankClient.Model

@inject HttpClient Http

<h3>Enable Two-Factor Authentication</h3>

<EditForm Model="@enable2FAModel" OnValidSubmit="HandleEnable2FA">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div>
        <label for="username">Username:</label>
        <InputText id="username" @bind-Value="enable2FAModel.Username" />
    </div>
    <button type="submit">Enable 2FA</button>
</EditForm>

@if (QrCodeSrc != null)
{
    <div>
        <h4>Scan this QR Code with your authenticator app:</h4>
        <img src="@QrCodeSrc" alt="QR Code" />
    </div>
}

@code {
    private Enable2FAModel enable2FAModel = new Enable2FAModel();
    private string QrCodeSrc;

    private async Task HandleEnable2FA()
    {
        var requestContent = new StringContent(
            JsonSerializer.Serialize(enable2FAModel),
            Encoding.UTF8,
            "application/json"
        );

        var response = await Http.PostAsync("api/Trainee/enable-2fa", requestContent);

        if (response.IsSuccessStatusCode)
        {
            var imageBytes = await response.Content.ReadAsByteArrayAsync();
            QrCodeSrc = $"data:image/png;base64,{Convert.ToBase64String(imageBytes)}";
        }
        else
        {
            // Handle error (you can log it or show an error message)
        }
    }
}

